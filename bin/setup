#!/usr/bin/env node

'use strict';

var fs = require('fs');
var path = require('path');
var request = require('request');

if ('dev' === (process.env['WHALER_SETUP'] || null)) {
    const dev = {
        version: '0.x-dev',
        sha: ''
    };

    fs.writeFileSync(path.dirname(__dirname) + '/dev.json', JSON.stringify(dev, null, 2));

    request({
        url: 'https://api.github.com/repos/whaler/whaler/commits/master',
        headers: {
            'User-Agent': 'whaler'
        }
    }, (err, resp, body) => {
        if (!err) {
            if (resp.statusCode == 200) {
                try {
                    const data = JSON.parse(body);

                    if (data['sha'] || null) {
                        dev['sha'] = data['sha'];
                        fs.writeFileSync(path.dirname(__dirname) + '/dev.json', JSON.stringify(dev, null, 2));
                    }
                } catch(e) {}
            }
        }
    });
}
